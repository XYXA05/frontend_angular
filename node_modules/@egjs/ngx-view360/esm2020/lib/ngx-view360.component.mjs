/**
 * Copyright (c) 2023-present NAVER Corp.
 * egjs projects are licensed under the MIT license
 */
/* eslint-disable @typescript-eslint/no-unused-vars */
import { Component, Input, ElementRef, Output, EventEmitter, NgZone, Inject, PLATFORM_ID, ViewChild, } from "@angular/core";
import { isPlatformServer } from "@angular/common";
import { fromEvent, Subject } from "rxjs";
import { takeUntil } from "rxjs/operators";
import VanillaView360, { EVENTS, DEFAULT_CLASS } from "@egjs/view360";
import View360Interface from "./View360Interface";
import { setterNames } from "./const";
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class NgxView360Component extends View360Interface {
    constructor(_elRef, _platformId, _ngZone) {
        super();
        this._elRef = _elRef;
        this._platformId = _platformId;
        this._ngZone = _ngZone;
        this.readyEmitter = new EventEmitter();
        this.loadStartEmitter = new EventEmitter();
        this.loadEmitter = new EventEmitter();
        this.projectionChangeEmitter = new EventEmitter();
        this.resizeEmitter = new EventEmitter();
        this.beforeRenderEmitter = new EventEmitter();
        this.renderEmitter = new EventEmitter();
        this.inputStartEmitter = new EventEmitter();
        this.inputEndEmitter = new EventEmitter();
        this.viewChangeEmitter = new EventEmitter();
        this.staticClickEmitter = new EventEmitter();
        this.vrStartEmitter = new EventEmitter();
        this.vrEndEmitter = new EventEmitter();
        this._destroy$ = new Subject();
        this._view360 = null;
    }
    get element() { return this._elRef.nativeElement; }
    get _canvasElClass() { return `${DEFAULT_CLASS.CANVAS} ${this.canvasClass ?? ""}`.trim(); }
    ngAfterViewInit() {
        if (isPlatformServer(this._platformId))
            return;
        const container = this._elRef.nativeElement;
        const options = this.options ?? {};
        this._view360 = this._ngZone.runOutsideAngular(() => new VanillaView360(container, options));
        this._bindEvents();
    }
    ngOnDestroy() {
        this._destroy$.next();
        this._view360?.destroy();
    }
    ngOnChanges(changes) {
        const view360 = this._view360;
        if (!view360)
            return;
        const changed = changes.options;
        if (!changed)
            return;
        const prev = changed.previousValue;
        const current = changed.currentValue;
        setterNames.forEach(name => {
            const oldProp = prev[name];
            const newProp = current[name];
            if (newProp !== oldProp) {
                view360[name] = newProp;
            }
        });
    }
    _bindEvents() {
        const view360 = this._view360;
        Object.keys(EVENTS).forEach(evtKey => {
            const evtName = EVENTS[evtKey];
            fromEvent(view360, evtName)
                .pipe(takeUntil(this._destroy$))
                .subscribe(event => {
                const emitter = this[`${evtName}Emitter`];
                if (emitter && emitter.observers.length > 0) {
                    this._ngZone.run(() => emitter.emit(event));
                }
            });
        });
    }
}
NgxView360Component.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: NgxView360Component, deps: [{ token: i0.ElementRef }, { token: PLATFORM_ID }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component });
NgxView360Component.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: NgxView360Component, selector: "ngx-view360, [NgxView360]", inputs: { options: "options", canvasClass: "canvasClass" }, outputs: { readyEmitter: "ready", loadStartEmitter: "loadStart", loadEmitter: "load", projectionChangeEmitter: "projectionChange", resizeEmitter: "resize", beforeRenderEmitter: "beforeRender", renderEmitter: "render", inputStartEmitter: "inputStart", inputEndEmitter: "inputEnd", viewChangeEmitter: "viewChange", staticClickEmitter: "staticClick", vrStartEmitter: "vrStart", vrEndEmitter: "vrEnd" }, host: { styleAttribute: "display: block;", classAttribute: "view360-container" }, viewQueries: [{ propertyName: "canvas", first: true, predicate: ["canvas"], descendants: true }], usesInheritance: true, usesOnChanges: true, ngImport: i0, template: `
    <canvas #canvas [ngClass]="_canvasElClass"></canvas>
    <ng-content></ng-content>
  `, isInline: true, dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: NgxView360Component, decorators: [{
            type: Component,
            args: [{
                    selector: "ngx-view360, [NgxView360]",
                    template: `
    <canvas #canvas [ngClass]="_canvasElClass"></canvas>
    <ng-content></ng-content>
  `,
                    host: {
                        style: "display: block;",
                        class: "view360-container"
                    }
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }, { type: i0.NgZone }]; }, propDecorators: { options: [{
                type: Input
            }], canvasClass: [{
                type: Input
            }], readyEmitter: [{
                type: Output,
                args: ["ready"]
            }], loadStartEmitter: [{
                type: Output,
                args: ["loadStart"]
            }], loadEmitter: [{
                type: Output,
                args: ["load"]
            }], projectionChangeEmitter: [{
                type: Output,
                args: ["projectionChange"]
            }], resizeEmitter: [{
                type: Output,
                args: ["resize"]
            }], beforeRenderEmitter: [{
                type: Output,
                args: ["beforeRender"]
            }], renderEmitter: [{
                type: Output,
                args: ["render"]
            }], inputStartEmitter: [{
                type: Output,
                args: ["inputStart"]
            }], inputEndEmitter: [{
                type: Output,
                args: ["inputEnd"]
            }], viewChangeEmitter: [{
                type: Output,
                args: ["viewChange"]
            }], staticClickEmitter: [{
                type: Output,
                args: ["staticClick"]
            }], vrStartEmitter: [{
                type: Output,
                args: ["vrStart"]
            }], vrEndEmitter: [{
                type: Output,
                args: ["vrEnd"]
            }], canvas: [{
                type: ViewChild,
                args: ["canvas"]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXZpZXczNjAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXZpZXczNjAvc3JjL2xpYi9uZ3gtdmlldzM2MC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBQ0gsc0RBQXNEO0FBQ3RELE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUVMLFVBQVUsRUFFVixNQUFNLEVBQ04sWUFBWSxFQUVaLE1BQU0sRUFDTixNQUFNLEVBQ04sV0FBVyxFQUVYLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxjQUFjLEVBQUUsRUFDckIsTUFBTSxFQUNOLGFBQWEsRUFlZCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7OztBQWF0QyxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsZ0JBQWdCO0lBeUJ2RCxZQUNVLE1BQStCLEVBQ1YsV0FBZ0IsRUFDckMsT0FBZTtRQUV2QixLQUFLLEVBQUUsQ0FBQztRQUpBLFdBQU0sR0FBTixNQUFNLENBQXlCO1FBQ1YsZ0JBQVcsR0FBWCxXQUFXLENBQUs7UUFDckMsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQXZCRCxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFjLENBQUM7UUFDMUMscUJBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQWtCLENBQUM7UUFDM0QsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBYSxDQUFDO1FBQ2hDLDRCQUF1QixHQUFHLElBQUks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O3NCQUE3QyxNQUFNO3VCQUFDLFlBQVk7Z0JBQ1Usa0JBQWtCO3NCQUEvQyxNQUFNO3VCQUFDLGFBQWE7Z0JBQ0ssY0FBYztzQkFBdkMsTUFBTTt1QkFBQyxTQUFTO2dCQUNPLFlBQVk7c0JBQW5DLE1BQU07dUJBQUMsT0FBTztnQkFFYSxNQUFNO3NCQUFqQyxTQUFTO3VCQUFDLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAyMy1wcmVzZW50IE5BVkVSIENvcnAuXG4gKiBlZ2pzIHByb2plY3RzIGFyZSBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqL1xuLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzICovXG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBBZnRlclZpZXdJbml0LFxuICBFbGVtZW50UmVmLFxuICBPbkNoYW5nZXMsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPbkRlc3Ryb3ksXG4gIE5nWm9uZSxcbiAgSW5qZWN0LFxuICBQTEFURk9STV9JRCxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybVNlcnZlciB9IGZyb20gXCJAYW5ndWxhci9jb21tb25cIjtcbmltcG9ydCB7IGZyb21FdmVudCwgU3ViamVjdCB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcbmltcG9ydCBWYW5pbGxhVmlldzM2MCwge1xuICBFVkVOVFMsXG4gIERFRkFVTFRfQ0xBU1MsXG4gIFJlYWR5RXZlbnQsXG4gIExvYWRTdGFydEV2ZW50LFxuICBMb2FkRXZlbnQsXG4gIFByb2plY3Rpb25DaGFuZ2VFdmVudCxcbiAgUmVzaXplRXZlbnQsXG4gIEJlZm9yZVJlbmRlckV2ZW50LFxuICBSZW5kZXJFdmVudCxcbiAgSW5wdXRTdGFydEV2ZW50LFxuICBJbnB1dEVuZEV2ZW50LFxuICBWaWV3Q2hhbmdlRXZlbnQsXG4gIFN0YXRpY0NsaWNrRXZlbnQsXG4gIFZSU3RhcnRFdmVudCxcbiAgVlJFbmRFdmVudCxcbiAgVmlldzM2ME9wdGlvbnNcbn0gZnJvbSBcIkBlZ2pzL3ZpZXczNjBcIjtcbmltcG9ydCBWaWV3MzYwSW50ZXJmYWNlIGZyb20gXCIuL1ZpZXczNjBJbnRlcmZhY2VcIjtcbmltcG9ydCB7IHNldHRlck5hbWVzIH0gZnJvbSBcIi4vY29uc3RcIjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcIm5neC12aWV3MzYwLCBbTmd4VmlldzM2MF1cIixcbiAgdGVtcGxhdGU6IGBcbiAgICA8Y2FudmFzICNjYW52YXMgW25nQ2xhc3NdPVwiX2NhbnZhc0VsQ2xhc3NcIj48L2NhbnZhcz5cbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIGAsXG4gIGhvc3Q6IHtcbiAgICBzdHlsZTogXCJkaXNwbGF5OiBibG9jaztcIixcbiAgICBjbGFzczogXCJ2aWV3MzYwLWNvbnRhaW5lclwiXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgTmd4VmlldzM2MENvbXBvbmVudCBleHRlbmRzIFZpZXczNjBJbnRlcmZhY2VcbiAgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgpIHB1YmxpYyBvcHRpb25zITogUGFydGlhbDxWaWV3MzYwT3B0aW9ucz47XG4gIEBJbnB1dCgpIHB1YmxpYyBjYW52YXNDbGFzcyE6IHN0cmluZztcblxuICBAT3V0cHV0KFwicmVhZHlcIikgcHVibGljIHJlYWR5RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8UmVhZHlFdmVudD4oKTtcbiAgQE91dHB1dChcImxvYWRTdGFydFwiKSBwdWJsaWMgbG9hZFN0YXJ0RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8TG9hZFN0YXJ0RXZlbnQ+KCk7XG4gIEBPdXRwdXQoXCJsb2FkXCIpIHB1YmxpYyBsb2FkRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8TG9hZEV2ZW50PigpO1xuICBAT3V0cHV0KFwicHJvamVjdGlvbkNoYW5nZVwiKSBwdWJsaWMgcHJvamVjdGlvbkNoYW5nZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPFByb2plY3Rpb25DaGFuZ2VFdmVudD4oKTtcbiAgQE91dHB1dChcInJlc2l6ZVwiKSBwdWJsaWMgcmVzaXplRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8UmVzaXplRXZlbnQ+KCk7XG4gIEBPdXRwdXQoXCJiZWZvcmVSZW5kZXJcIikgcHVibGljIGJlZm9yZVJlbmRlckVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPEJlZm9yZVJlbmRlckV2ZW50PigpO1xuICBAT3V0cHV0KFwicmVuZGVyXCIpIHB1YmxpYyByZW5kZXJFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxSZW5kZXJFdmVudD4oKTtcbiAgQE91dHB1dChcImlucHV0U3RhcnRcIikgcHVibGljIGlucHV0U3RhcnRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxJbnB1dFN0YXJ0RXZlbnQ+KCk7XG4gIEBPdXRwdXQoXCJpbnB1dEVuZFwiKSBwdWJsaWMgaW5wdXRFbmRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxJbnB1dEVuZEV2ZW50PigpO1xuICBAT3V0cHV0KFwidmlld0NoYW5nZVwiKSBwdWJsaWMgdmlld0NoYW5nZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPFZpZXdDaGFuZ2VFdmVudD4oKTtcbiAgQE91dHB1dChcInN0YXRpY0NsaWNrXCIpIHB1YmxpYyBzdGF0aWNDbGlja0VtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPFN0YXRpY0NsaWNrRXZlbnQ+KCk7XG4gIEBPdXRwdXQoXCJ2clN0YXJ0XCIpIHB1YmxpYyB2clN0YXJ0RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8VlJTdGFydEV2ZW50PigpO1xuICBAT3V0cHV0KFwidnJFbmRcIikgcHVibGljIHZyRW5kRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8VlJFbmRFdmVudD4oKTtcblxuICBAVmlld0NoaWxkKFwiY2FudmFzXCIpIHB1YmxpYyBjYW52YXMhOiBFbGVtZW50UmVmPEhUTUxDYW52YXNFbGVtZW50PjtcblxuICBwdWJsaWMgZ2V0IGVsZW1lbnQoKSB7IHJldHVybiB0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50OyB9XG4gIHB1YmxpYyBnZXQgX2NhbnZhc0VsQ2xhc3MoKSB7IHJldHVybiBgJHtERUZBVUxUX0NMQVNTLkNBTlZBU30gJHt0aGlzLmNhbnZhc0NsYXNzID8/IFwiXCJ9YC50cmltKCk7IH1cbiAgcHJpdmF0ZSBfZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9lbFJlZjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4sXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBfcGxhdGZvcm1JZDogYW55LFxuICAgIHByaXZhdGUgX25nWm9uZTogTmdab25lXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fdmlldzM2MCA9IG51bGw7XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGlmIChpc1BsYXRmb3JtU2VydmVyKHRoaXMuX3BsYXRmb3JtSWQpKSByZXR1cm47XG5cbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMgPz8ge307XG5cbiAgICB0aGlzLl92aWV3MzYwID0gdGhpcy5fbmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKFxuICAgICAgKCkgPT4gbmV3IFZhbmlsbGFWaWV3MzYwKGNvbnRhaW5lciwgb3B0aW9ucylcbiAgICApO1xuXG4gICAgdGhpcy5fYmluZEV2ZW50cygpO1xuICB9XG5cbiAgcHVibGljIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuX2Rlc3Ryb3kkLm5leHQoKTtcbiAgICB0aGlzLl92aWV3MzYwPy5kZXN0cm95KCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnN0IHZpZXczNjAgPSB0aGlzLl92aWV3MzYwO1xuICAgIGlmICghdmlldzM2MCkgcmV0dXJuO1xuXG4gICAgY29uc3QgY2hhbmdlZCA9IGNoYW5nZXMub3B0aW9ucztcbiAgICBpZiAoIWNoYW5nZWQpIHJldHVybjtcblxuICAgIGNvbnN0IHByZXYgPSBjaGFuZ2VkLnByZXZpb3VzVmFsdWU7XG4gICAgY29uc3QgY3VycmVudCA9IGNoYW5nZWQuY3VycmVudFZhbHVlO1xuXG4gICAgc2V0dGVyTmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgIGNvbnN0IG9sZFByb3AgPSBwcmV2W25hbWVdO1xuICAgICAgY29uc3QgbmV3UHJvcCA9IGN1cnJlbnRbbmFtZV07XG5cbiAgICAgIGlmIChuZXdQcm9wICE9PSBvbGRQcm9wKSB7XG4gICAgICAgICh2aWV3MzYwIGFzIGFueSlbbmFtZV0gPSBuZXdQcm9wO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBfYmluZEV2ZW50cygpIHtcbiAgICBjb25zdCB2aWV3MzYwID0gdGhpcy5fdmlldzM2MCE7XG5cbiAgICBPYmplY3Qua2V5cyhFVkVOVFMpLmZvckVhY2goZXZ0S2V5ID0+IHtcbiAgICAgIGNvbnN0IGV2dE5hbWUgPSAoRVZFTlRTIGFzIGFueSlbZXZ0S2V5XTtcblxuICAgICAgZnJvbUV2ZW50KHZpZXczNjAsIGV2dE5hbWUpXG4gICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCkpXG4gICAgICAgIC5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICAgIGNvbnN0IGVtaXR0ZXIgPSAodGhpcyBhcyBhbnkpW2Ake2V2dE5hbWV9RW1pdHRlcmBdO1xuICAgICAgICAgIGlmIChlbWl0dGVyICYmIGVtaXR0ZXIub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX25nWm9uZS5ydW4oKCkgPT4gZW1pdHRlci5lbWl0KGV2ZW50KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuIl19